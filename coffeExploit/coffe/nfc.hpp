#include <string>
#include <nfc/nfc.h>
#include "mifare.h"

class Nfc {
	public:
		Nfc();
		~Nfc();
		
		bool connect();
		bool disconnect();
	
		void dump();
	
		std::string getUid();
		std::string getType();
	
		bool read(int block, uint8_t* data);
		bool write(int block, uint8_t* data);

		void initValue(int sector, int block, int value);
		int readValue(int sector, int block);
		int incValue(int sector, int block, int value);
		int decValue(int sector, int block, int value);

		bool authenticate(int block, uint8_t* key, char keyType);
	
		static uint8_t keys[];
		
		uint32_t get_trailer_block(uint32_t uiFirstBlock);
		bool is_trailer_block(uint32_t uiBlock);
	protected:
		void print_hex(const uint8_t *pbtData, const size_t szBytes);
		
	private:
		nfc_device *pnd;
		nfc_target nt;
		mifare_param mp;
		mifare_classic_tag mtKeys;
		mifare_classic_tag mtDump;
		

		static const nfc_modulation nmMifare;


		//#define MAX_FRAME_LEN 264

		//uint8_t abtRx[MAX_FRAME_LEN];
		//int szRxBits;
};

